<!DOCTYPE html>
{% load static %}
<html lang="ko">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>커뮤니티</title>
    <link rel="stylesheet" href="{% static 'css/free/Community.css' %}" type="text/css">
    <link rel="stylesheet" type="text/css"  href="https://st.kakaocdn.net/commerce_cs/css/20210422/h.css">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
    </script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
            crossorigin="anonymous"></script>


    <script type="text/javascript" src="https://st.kakaocdn.net/commerce_cs/js/jquery-2.1.1.min.js"></script>



</head>

<body>
<div id="sub-wrap" class="sub">
    <div class="container" style="margin-left: 13%;">
        <div class="left col-md-2 " style="display: inline-block; height: 100px;">
            <div class="left-head">

                <h2>커뮤니티</h2>
            </div>
        </div>


        <div class="row">
            <div class="col-3">
                <div class="list-group text-center" id="list-tab" role="tablist">
                    <a class="list-group-item list-group-item-action" id="list-home-list" data-toggle="list"
                       href="#list-home" role="tab" aria-controls="home">자유게시판</a>
                    <a class="list-group-item list-group-item-action" id="list-profile-list" data-toggle="list"
                       href="#list-profile" role="tab" aria-controls="profile">법률TIP</a>
                    <a class="list-group-item list-group-item-action" id="list-messages-list" data-toggle="list"
                       href="#list-messages" role="tab" aria-controls="messages">묻고 답하기</a>
                    <div class="list-group-item" style="height: 48vh; width:82%"></div>
                </div>
            </div>
            <div class="col-8">
                <div class="tab-content" id="nav-tabContent" style="margin-top: -20%;">
                    {% block content %}
                    {% endblock %}
                </div>
            </div>
        </div>

        <script>
     var deviceType = undefined;
            var attachedFileNumber = 0;
            var serviceKey = '111';
            var modifyContInquiryFlag = false;
            var compareContent = '';
            var privacyAgreementFlag = false;
            var privacyThirdPartyAgreementFlag = false;
            $(document).ready(function() {
                $('.link_before').on('click', function() {
                    $(this).parents('.check_before').toggleClass('fold_on');
                });

                $('.link_all').on('click', function() {
                    $(this).parents('.agree_entercs').toggleClass('fold_on');
                    if($(this).attr('aria-expanded')) {
                        $(this).attr('aria-expanded', 'false');
                    } else {
                        $(this).attr('aria-expanded', 'true');
                    }
                    var checkBoxId = $(this).attr('id');
                    if(checkBoxId === 'privacyAgreement') {
                        privacyAgreementFlag = true;
                    } else if(checkBoxId === 'privacyThirdPartyAgreement') {
                        privacyThirdPartyAgreementFlag = true;
                    }
                });

                $('.link_select').on('click', function() {
                    $(this).parents('.select_entercs').toggleClass('select_open');
                    if($(this).attr('aria-expanded')) {
                        $(this).attr('aria-expanded', 'false');
                    } else {
                        $(this).attr('aria-expanded', 'true');
                    }
                });

                $('.inp_check').on('click', function() {
                    if($(this).is(":checked")) {
                        $(this).parents('.check_entercs').removeClass('fill_error');
                    }
                });

                $('#contInquiry').on('keydown keyup click paste', function() {
                    main.common.webContentLengthCheck($(this));
                }).on('change', function() {
                    modifyContInquiryFlag = true;
                });



                $(document).on('click', '.link_opt', function() {
                    var selectedValue = $(this).children('span').text();
                    $(this).parents('.select_entercs').children('.link_select').text(selectedValue);
                    $(this).parents('.select_entercs').children('.link_select').append("<span class=\"ico_commercecs ico_arrow\">선택됨</span>");
                    if($(this).parents('.select_entercs').hasClass('select_done')) {
                    } else {
                        $(this).parents('.select_entercs').addClass('select_done');
                    }

                    $(this).parents('.select_entercs').toggleClass('select_open');
                    if($(this).attr('aria-expanded')) {
                        $(this).attr('aria-expanded', 'false');
                    } else {
                        $(this).attr('aria-expanded', 'true');
                    }

                    var id = $(this).parents('ul') !== undefined ? $(this).parents('ul').attr('id') : undefined;
                    if(id === 'firstCategories') {
                        var categoryId = $(this).parents('li').attr('value');
                        initGuideContent();
                        if(modifyContInquiryFlag == false) {
                            initInquiryContent();
                        }
                        $('#categoryId').val('');
                        initTwoDepthCategoryBlock(deviceType);
                        requestTwoDepthCategory(serviceKey, categoryId);
                    } else if (id === 'secondCategories') {
                        var categoryId = $(this).parents('li').attr('value');
                        if(modifyContInquiryFlag == false) {
                            initInquiryContent();
                        }
                        requestCategoryInfo(serviceKey, categoryId);
                        $('#categoryId').val(categoryId);

                        var categoryId = $('input[name=categoryId]').val();
                        if(categoryId === undefined || !main.common.filter.validatePositiveNumber(categoryId)) {
                            $("div[id$='Category']").addClass('fill_error');
                        } else {
                            $("div[id$='Category']").removeClass('fill_error');
                        }
                    } else if(id === 'countryNumbers') {
                        var countryNumber = $(this).parents('li').attr('value');
                        $('#countryNumber').val(countryNumber);
                    }
                });

                $(document).on('change', '.opt_select', function() {
                    var selectedValue = $(this).children('option:selected').val();
                    var selectedDisplayText = $(this).children('option:selected').text();

                    $(this).parents('.select_entercs').children('.link_select').text(selectedDisplayText);
                    $(this).parents('.select_entercs').children('.link_select').append("<span class=\"ico_commercecs ico_arrow\">선택됨</span>");

                    var id = $(this).attr('id');
                    if(id === 'firstSelect') {
                        initGuideContent();
                        if(modifyContInquiryFlag == false) {
                            initInquiryContent();
                        }
                        initTwoDepthCategoryBlock(deviceType);
                        requestTwoDepthCategory(serviceKey, selectedValue);
                        $('#categoryId').val('');

                        if($(this).val() == "0" || $(this).val() == "") {
                            $(this).parents('.select_entercs').removeClass('select_done');
                            $('#lstSelect').parents('.select_entercs').removeClass('select_done').addClass('select_disabled');
                            $('#lstSelect option').remove();
                            $('#lstSelect').prop("disabled", true);
                        } else if($(this).parents('.select_entercs').hasClass('select_done') == false) {
                            $(this).parents('.select_entercs').addClass('select_done');
                            $('#lstSelect').prop("disabled", false);
                        }

                        $('#lstSelect').parents('.select_entercs').removeClass('select_done')
                    } else if(id === 'lstSelect') {
                        if(modifyContInquiryFlag == false) {
                            initInquiryContent();
                        }
                        requestCategoryInfo(serviceKey, selectedValue);
                        $('#categoryId').val(selectedValue);

                        if($(this).val() == "0" || $(this).val() == "") {
                            $(this).parents('.select_entercs').removeClass('select_done');
                        } else {
                            $(this).parents('.select_entercs').addClass('select_done');
                        }

                        var categoryId = $('input[name=categoryId]').val();
                        if(categoryId === undefined || !main.common.filter.validatePositiveNumber(categoryId)) {
                            $("div[id$='Category']").addClass('fill_error');
                        } else {
                            $("div[id$='Category']").removeClass('fill_error');
                        }
                    } else if(id === 'countryCode') {
                        $('#countryNumber').val(selectedValue);
                    }
                });



                function requestCategoryInfo(serviceId, categoryId) {
                    if(categoryId == "0" || categoryId == "") {
                        return;
                    }

                    var requestUrl = "/api/request/service/" + serviceId + "/category/" + categoryId;
                    $.when(
                        $.ajax({
                            url: requestUrl,
                            success: function(result) {
                                liTags = [];
                                var category = undefined;
                                if(result && result.code === 200) {
                                    category = result.entity;
                                }
                                if(category) {
                                    var templateContent = category.templateContent;
                                    var guideContent = category.guideContent;
                                    if(templateContent) {
                                        if(modifyContInquiryFlag == false) {
                                            $('#contInquiry').val(templateContent);
                                        }
                                        compareContent = templateContent.replace(/( |\n|\n\r)/gi, '');
                                    }
                                    if(guideContent) {
                                        displayGuideContent(guideContent);
                                    } else {
                                        initGuideContent();
                                    }
                                }
                            }
                        })
                    );
                };



                function initInquiryContent() {
                    $('#contInquiry').val('');
                };

                function initGuideContent() {
                    if($('.check_before').hasClass('hide')) {
                    } else {
                        $('.check_before').addClass('hide');
                        $('.check_before').removeClass('fold_on');
                    }

                    if($('.list_before').has('li')) {
                        $('.list_before').empty();
                    }
                };

                function displayGuideContent(guideContent) {
                    if($('.list_before').has('li')) {
                        $('.list_before').empty();
                    }

                    if($('.check_before').hasClass('hide')) {
                        $('.check_before').removeClass('hide');
                    }

                    if(guideContent) {
                        var lines = guideContent.split('\n');
                        if(lines) {
                            for(var i=0;i<lines.length;i++) {
                                var liTag = '<li>' + lines[i] + '</li>';
                                $('.list_before').append(liTag);
                            }
                        }
                    }
                };
            });
</script>
</body>
</html>